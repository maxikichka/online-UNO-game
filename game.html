<!DOCTYPE html>
<html>

<body>
	<script src="/socket.io/socket.io.js">
	</script>

	<script>
		function cardToMatch(myCards) {
      myCards = myCards.split(" ");
      let cardFieldSet = document.createElement("fieldset");

      cardFieldSet.style["width"] = "100px";
      cardFieldSet.style["height"] = "200px";

      if (myCards.indexOf("number-color") > -1) {
        let cardNum = document.createElement("legend");
        cardNum.innerText = myCards[0];
        cardFieldSet.style["background-color"] = myCards[1];
        cardFieldSet.style["font-size"] = "30px";
        cardFieldSet.appendChild(cardNum);
      } else if (myCards.indexOf("reverse-color") > -1) {
        let cardNum = document.createElement("legend");
        cardNum.innerText = "r";
        cardFieldSet.style["background-color"] = myCards[0];
        cardFieldSet.style["font-size"] = "30px";
        cardFieldSet.appendChild(cardNum);
      } else if (myCards.indexOf("plus2-color") > -1) {
        let cardNum = document.createElement("legend");
        cardNum.innerText = "+2";
        cardFieldSet.style["background-color"] = myCards[0];
        cardFieldSet.style["font-size"] = "30px";
        cardFieldSet.appendChild(cardNum);
      } else if (myCards.indexOf("skip-color") > -1) {
        let cardNum = document.createElement("legend");
        cardNum.innerText = "skip";
        cardFieldSet.style["background-color"] = myCards[0];
        cardFieldSet.style["font-size"] = "30px";
        cardFieldSet.appendChild(cardNum);
      } else if (myCards.indexOf("normal-wild") > -1) {
        let cardNum = document.createElement("legend");
        cardNum.innerText = "wild";
        cardFieldSet.style["background-color"] = "#000000";
        cardFieldSet.style["font-size"] = "30px";
        cardFieldSet.appendChild(cardNum);
      } else if (myCards.indexOf("plus4-wild") > -1) {
        let cardNum = document.createElement("legend");
        cardNum.innerText = "+4";
        cardFieldSet.style["background-color"] = "#000000";
        cardFieldSet.style["font-size"] = "30px";
        cardFieldSet.appendChild(cardNum);
      }
      document.body.appendChild(cardFieldSet);
    }

    function generateCards(myCards) {
      for (let i = 0; i < myCards.length; i++) {
        let cardFieldSet = document.createElement("fieldset");
        if (myCards[i].indexOf("number-color") > -1) {
          let cardNum = document.createElement("legend");
          cardNum.innerText = myCards[i][0];
          cardFieldSet.style["background-color"] = myCards[i][1];
          cardFieldSet.style["font-size"] = "30px";
          cardFieldSet.appendChild(cardNum);
        } else if (myCards[i].indexOf("reverse-color") > -1) {
          let cardNum = document.createElement("legend");
          cardNum.innerText = "r";
          cardFieldSet.style["background-color"] = myCards[i][0];
          cardFieldSet.style["font-size"] = "30px";
          cardFieldSet.appendChild(cardNum);
        } else if (myCards[i].indexOf("plus2-color") > -1) {
          let cardNum = document.createElement("legend");
          cardNum.innerText = "+2";
          cardFieldSet.style["background-color"] = myCards[i][0];
          cardFieldSet.style["font-size"] = "30px";
          cardFieldSet.appendChild(cardNum);
        } else if (myCards[i].indexOf("skip-color") > -1) {
          let cardNum = document.createElement("legend");
          cardNum.innerText = "skip";
          cardFieldSet.style["background-color"] = myCards[i][0];
          cardFieldSet.style["font-size"] = "30px";
          cardFieldSet.appendChild(cardNum);
        } else if (myCards[i].indexOf("normal-wild") > -1) {
          let cardNum = document.createElement("legend");
          cardNum.innerText = "wild";
          cardFieldSet.style["background-color"] = "#000000";
          cardFieldSet.style["font-size"] = "30px";
          cardFieldSet.appendChild(cardNum);
        } else if (myCards[i].indexOf("plus4-wild") > -1) {
          let cardNum = document.createElement("legend");
          cardNum.innerText = "+4";
          cardFieldSet.style["background-color"] = "#000000";
          cardFieldSet.style["font-size"] = "30px";
          cardFieldSet.appendChild(cardNum);
        }
        cardElements.push(cardFieldSet);
        if (yourTurn) {
          let placeCardBtn = document.createElement("button");
          placeCardBtn.innerText = "Place card";
          placeCardBtn.id = i + " placeCardBtn";
          placeCardBtn.onclick = function(clicked) {
            console.log(cardElements[this.id.split(" ")[0]]);

            selectedCard = cards[this.id.split(" ")[0]];

            let placeCardPreview = document.createElement("fieldset");
            placeCardPreview.style["position"] = "absolute";
            placeCardPreview.style["left"] = "200px";
            placeCardPreview.style["top"] = "80px";
            placeCardPreview.style["background-color"] = cardElements[this.id.split(" ")[0]].style["background-color"];
            let palceCardPreviewLabel = document.createElement("legend");
            palceCardPreviewLabel.innerText = cardElements[this.id.split(" ")[0]].innerText.split("\n")[0];
            placeCardPreview.appendChild(palceCardPreviewLabel);

            let confirmOrder = document.createElement("button");
            confirmOrder.innerText = "<------ confirm card";
            confirmOrder.onclick = function() {
              socket.emit("move", [selectedCard, name]);
            }
            placeCardPreview.appendChild(confirmOrder);
            
            // let placeCardPreview = cardElements[this.id.split(" ")[0]].cloneNode(true);
            // placeCardPreview.style["position"] = "absolute";
            // placeCardPreview.style["left"] = "200px";
            // placeCardPreview.style["top"] = "80px";
            // placeCardPreview.removeAttribute("id");
            
            document.body.appendChild(placeCardPreview);
          };
          cardFieldSet.appendChild(placeCardBtn);
        }
        document.body.appendChild(cardFieldSet);
      }
    }
	</script>

	<script>
		var socket = io();
    var yourTurn = false;
    var cards = [];
    var cardElements = [];
    var selectedCard = "";

    let name = prompt("Please enter your name", "");
    socket.emit("looking for match", name);
    let waiting = document.createElement("h1");
    waiting.innerText = "Looking for opponent... ";
    waiting.id = "statusbar";
    document.body.appendChild(waiting);

    socket.on("match found", function(msg) {
      socket.emit("give my cards", "");
    });
    socket.on("here are your cards", function(msg) {
      cards = msg[0];
      if (msg[2] == "first") {
        yourTurn = true;
        document.getElementById("statusbar").innerText = "Your turn!";
      } else {
        document.getElementById("statusbar").innerText = "Waiting for someone to move...";
      }
      console.log(msg);
      cardToMatch(msg[1])
      generateCards(msg[0]);
    });

    socket.on("move", function(msg) {
      console.log(msg);
      if (msg[0] == "your turn") {
        yourTurn = true;
      } else {
        yourTurn = false;
      }
      if (yourTurn) {
        for (let i = 0; i < cardElements.length; i++) {
          let placeCardBtn = document.createElement("button");
          placeCardBtn.innerText = "Place card";
          placeCardBtn.id = i + " placeCardBtn";
          placeCardBtn.onclick = function() {
            console.log(cardElements[this.id.split(" ")[0]]);

            selectedCard = cards[this.id.split(" ")[0]];

            let placeCardPreview = document.createElement("fieldset");
            placeCardPreview.style["position"] = "absolute";
            placeCardPreview.style["left"] = "200px";
            placeCardPreview.style["top"] = "80px";
            placeCardPreview.style["background-color"] = cardElements[this.id.split(" ")[0]].style["background-color"];
            let palceCardPreviewLabel = document.createElement("legend");
            palceCardPreviewLabel.innerText = cardElements[this.id.split(" ")[0]].innerText.split("\n")[0];
            placeCardPreview.appendChild(palceCardPreviewLabel);

            let confirmOrder = document.createElement("button");
            confirmOrder.innerText = "<------ confirm card";
            confirmOrder.onclick = function() {
              socket.emit("move", [selectedCard, name]);
            }
            placeCardPreview.appendChild(confirmOrder);
            
            // let placeCardPreview = cardElements[this.id.split(" ")[0]].cloneNode(true);
            // placeCardPreview.style["position"] = "absolute";
            // placeCardPreview.style["left"] = "200px";
            // placeCardPreview.style["top"] = "80px";
            // placeCardPreview.removeAttribute("id");
            
            document.body.appendChild(placeCardPreview);
          }
          cardElements[i].appendChild(placeCardBtn);
        }

      } else {
        for (let i = 0; i < cardElements.length; i++) {
          document.getElementById(i + " placeCardBtn").remove();
          
        }
      }

    });
	</script>

</body>

</html>